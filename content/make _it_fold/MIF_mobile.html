<html>
  <head>
    <title>Make It Swing!</title>
    <meta charset="utf-8" />
    <style>
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 90%;
      }
      .img {
        position: absolute;
        height: 90%;
        z-index: 1;
        visibility: hidden;
      }
      #canvas {
        margin-left: auto;
        margin-right: auto;
        position: absolute;
        z-index: 2;
      }
      #menu_div {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img class="img" src="../../public/default.png" alt="Make It Fold!" />
      <canvas id="canvas" style="border: 0px solid black;">
        Your browser does not support the HTML5 canvas tag.</canvas
      >
    </div>
    <div id="menu_div"></div>
  </body>
</html>

<script>
  var img = document.getElementsByClassName("img")[0];
  var canvas = document.getElementById("canvas");
  var userimg = document.getElementById("userimg");
  var width = img.width;
  var height = img.height;

  img.addEventListener("load", setimage());

  function setimage() {
    canvas.setAttribute("width", width * 1.6);
    canvas.setAttribute("height", height * 1.6);
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0, width, height, 0, 0, width * 1.6, height * 1.6);
  }

  canvas.addEventListener("click", split);
  canvas.myParam = event;

  function split(event) {
    var Y = event.clientY;
    console.log(event);
    var split_canvas = document.createElement("canvas");
    split_canvas.style.position = "absolute";
    split_canvas.style.top = "80px";
    split_canvas.setAttribute("id", "split_canvas");
    split_canvas.setAttribute("width", width * 1.6);
    split_canvas.setAttribute("height", Y * 1.6);
    split_canvas.style.zIndex = "3";
    var p = document.getElementsByClassName("container")[0];
    p.appendChild(split_canvas);

    var ctx = canvas.getContext("2d");
    var img_data = ctx.getImageData(0, 0, width * 1.6, Y);
    var split_ctx = split_canvas.getContext("2d");
    split_ctx.putImageData(img_data, 0, 0);
    ctx.clearRect(0, 0, width * 1.6, Y);

    canvas.removeEventListener("click", split);
    split_canvas.addEventListener("touchmove", swing);
    split_canvas.myParam = event;
  }

  var startX = 0;
  var startY = 0;

  function swing(e) {
    if (startX == 0 && startY == 0) {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }

    console.log(startY - e.touches[0].clientY);
    var Xdeg = Math.round(startX - e.touches[0].clientX) / 5;
    var Ydeg = Math.round(startY - e.touches[0].clientY) / 3;
    if (Xdeg <= 70 && Xdeg >= -70) {
      split_canvas.style.transform =
        "skewX(" + Xdeg + "deg) translateX(" + -Xdeg * 2 + "px)";
    }
  }
</script>
